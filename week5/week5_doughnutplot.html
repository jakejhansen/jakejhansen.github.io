<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<title>D3: Pie layout doughnut chart</title>
	<script type="text/javascript" src="../d3.js"></script>
	<style type="text/css">
		text {
			font-family: sans-serif;
			font-size: 12px;
			fill: white;
		}
	</style>
</head>

<body>
	<script type="text/javascript">

		//Width and height
		var w = 300;
		var h = 300;

		var dataset = [0.240, 0.222, 0.294, 0.197, 0.046];
		var bor = ['MANHATTAN', 'BRONX', 'BROOKLYN', 'QUEENS', 'STATEN ISLAND'];
		var outerRadius = w / 2;
		var innerRadius = w / 3;
		var arc = d3.arc()
			.innerRadius(innerRadius)
			.outerRadius(outerRadius);

		var pie = d3.pie();

		//Easy colors accessible via a 10-step ordinal scale
		var color = d3.scaleOrdinal(d3.schemeCategory10);

		//Create SVG element
		var svg = d3.select("body")
			.append("svg")
			.attr("width", w)
			.attr("height", h);

		//Set up groups
		var arcs = svg.selectAll("g.arc")
			.data(pie(dataset))
			.enter()
			.append("g")
			.attr("class", "arc")
			.attr("transform", "translate(" + outerRadius + "," + outerRadius + ")");

		//Draw arc paths
		arcs.append("path")
			.attr("fill", function (d, i) {
				return color(i);
			})
			.attr("d", arc)
			.on("click", function (d) {
				var rotate = 180 - (d.startAngle + d.endAngle) / 2 / Math.PI * 180;
				arcs.transition()
					.duration(1000)
					.attr("transform", "translate(" + outerRadius + "," + outerRadius + ") rotate(" + rotate + ")");

				text.transition()
					.attr("transform", function (dd) {
						return "translate(" + arc.centroid(dd) + ") rotate(" + (-rotate) + ")";
					})
					.duration(1000)
			})

		//Labels (Stolen from stackoverflow)
		var text = arcs.append("text")
			.attr("transform", function (d) {
				return "translate(" + arc.centroid(d) + ")";
			})
			.attr("text-anchor", "middle")
			.text(function (d) {
				return d.value * 100 + "%";
			});

		// again rebind for legend
		var legendG = svg.selectAll(".legend") // note appending it to mySvg and not svg to make positioning easier
			.data(pie(dataset))
			.enter().append("g")
			.attr("transform", function (d, i) {
				return "translate(" + (w / 2 - 40) + "," + (i * 15 + h / 3 + 10) + ")"; // place each legend on the right and bump each one down 15 pixels
			})
			.attr("class", "legend");

		legendG.append("rect") // make a matching color rect
			.attr("width", 10)
			.attr("height", 10)
			.attr("fill", function (d, i) {
				return color(i);
			});

		legendG.append("text") // add the text
			.text(function (d, i) {
				return bor[i];
			})
			.attr("text-anchor", "right")
			.style("font-size", 12)
			.attr("y", 10)
			.attr("x", 11)
			.style("fill", "black");

	
	</script>
</body>

</html>