<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Adding and removing values from a chart</title>
		<script type="text/javascript" src="../d3.js"></script>
		<style type="text/css">
			/* No style rules here yet */
		</style>
	</head>
	<body style="width:60%; margin-left:1%;">

		<p>This is a reproduction of<a href="http://iquantny.tumblr.com/post/129373499164/this-is-quantifiably-the-best-month-to-go-to-the">http://iquantny.tumblr.com/post/129373499164/this-is-quantifiably-the-best-month-to-go-to-the</a> </p>
		<h1>This is Quantifiably the Best Month to go to the Farmers Market</h1>
		<p>As part of a homework assignment, I ask my students at Pratt to go out and chart something of interest to them, and <a href="https://t.umblr.com/redirect?z=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fkvsavarese&amp;t=NmE2YmYyYjU4NTI3MTFhYWFiMWE1ZjFhNzc1NmUzMmE0ZDQ4OGM2NSwxeHM2a1phNg%3D%3D&amp;b=t%3A5jlxwUw4OZ-2SbgNDPgKMQ&amp;p=http%3A%2F%2Fiquantny.tumblr.com%2Fpost%2F129373499164%2Fthis-is-quantifiably-the-best-month-to-go-to-the&amp;m=1">Katherine Savarese</a> came back with a simple chart about farmers markets that I loved- it inspired this post.</p>
		<p>You probably know that farmers markets are a staple across <a href="https://t.umblr.com/redirect?z=http%3A%2F%2Fwww.grownyc.org%2Ffiles%2Fgmkt%2Fmap.pdf&amp;t=MGM4YmRjZjQ2ZmFmYzBiYmMzMmY5NDU2MTdiNzMzMmYyOWQ5YjQ2ZSwxeHM2a1phNg%3D%3D&amp;b=t%3A5jlxwUw4OZ-2SbgNDPgKMQ&amp;p=http%3A%2F%2Fiquantny.tumblr.com%2Fpost%2F129373499164%2Fthis-is-quantifiably-the-best-month-to-go-to-the&amp;m=1">all five boroughs</a> of New York City, but September happens to be a very special month.  Why is that? &nbsp;Well, it turns out September is the month with the most unique types of fresh produce- forty three to be exact.</p>
		<p>To show the current offerings, we charted how many types of fruits and vegetables are available by month, and showed if they were fresh or from storage.&nbsp;</p>
		<select id="inds">
			<option value="0">Fresh Fruit</option>
			<option value="1">Fresh Vegetable</option>
			<option value="2">Storage Fruit</option>
			<option value="3">Storage Vegetable</option>
		  </select>
		  <p>  </p>
		<script type="text/javascript">

			//Width and height
			var w = 600;
			var h = 250;
			var padding = 20;
			var dataset = [];
			var index = 0;
			var xScale;
			var yScale


			var rowConverter = function(d) {
				return {
					Index: parseInt(d.Index),
					Month: d.Month,
					Count: parseInt(d.Count)
				};
			}

			//Load in the data
			d3.csv("data.csv", rowConverter, function(data) {

				//Copy data into global dataset
				data_base = data;

				for (let i = 0; i < data_base.length; i++) {
					if (data_base[i]["Index"] == index){
						dataset.push(data_base[i])
					}
				}


				xScale = d3.scaleBand()
							.domain(["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ])
							.rangeRound([0, w])
							.paddingInner(0.05);
			
				yScale = d3.scaleLinear()
								.domain([0, d3.max(dataset, function(d) { 
									return d.Count;
									})])
								.range([padding, h]);

				//Create SVG element
				var svg = d3.select("body")
							.append("svg")
							.attr("width", w)
							.attr("height", h);

				//Create bars
				svg.selectAll("rect")
				.data(dataset)
				.enter()
				.append("rect")
				.attr("x", function(d, i) {
						return xScale(d.Month);
				})
				.attr("y", function(d) {
						return h - yScale(d.Count);
				})
				.attr("width", xScale.bandwidth())
				.attr("height", function(d) {
						return yScale(d.Count) - padding;
				})
				.attr("fill", function(d) {
						return "rgb(0, 0, 255)";
				});

				
				//Create labels
				svg.selectAll("text")
				.data(dataset)
				.enter()
				.append("text")
				.text(function(d) {
						return d.Count;
				})
				.attr("text-anchor", "middle")
				.attr("x", function(d, i) {
						return xScale(d.Month) + xScale.bandwidth() / 2;
				})
				.attr("y", function(d) {
						return h - yScale(d.Count) + 14;
				})
				.attr("font-family", "sans-serif")
				.attr("font-size", "11px")
				.attr("fill", "white");
				
				d3.select("select")
				.on("change", function() {
					var sect = document.getElementById("inds");
					var index = parseInt(sect.options[sect.selectedIndex].value);
					//New values for dataset					 		//Count original length of dataset
					var maxValue = 100;
					var len = dataset.length;											//Highest possible new value
					dataset = [];  						 				 		//Initialize empty array
					for (var i = 0; i < data_base.length; i++) {
						if (data_base[i]["Index"] == index){
							dataset.push(data_base[i]);			 			 		//Add new number to array
						}
					}

					//Update scale domain
					//Recalibrate the scale domain, given the new max value in dataset
					yScale.domain([0, d3.max(dataset, function(d){
						return d.Count;
					})]);

					//Update all rects
					svg.selectAll("rect")
					   .data(dataset)
					   .transition()
					   .duration(800)
					   .attr("x", function(d, i) {
						return xScale(d.Month);
						})
						.attr("y", function(d) {
								return h - yScale(d.Count);
						})
						.attr("width", xScale.bandwidth())
						.attr("height", function(d) {
								return yScale(d.Count) - padding;
						})
						.attr("fill", function(d) {
								return "rgb(0, 0, 255)";
						});

					//Update all labels
					svg.selectAll("text")
					   .data(dataset)
					   .transition()
					   .duration(800)
					   .text(function(d) {
						return d.Count;
						})
						.attr("text-anchor", "middle")
						.attr("x", function(d, i) {
								return xScale(d.Month) + xScale.bandwidth() / 2;
						})
						.attr("y", function(d) {
								return h - yScale(d.Count) + 14;
						})
						.attr("font-family", "sans-serif")
						.attr("font-size", "11px")
						.attr("fill", "white");

				});
				svg.append("g")
				.attr("transform", "translate(0," + (h - padding) + ")")
				.call(d3.axisBottom(xScale))
			});

		</script>
	</body>
</html>